<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AR Drifting Car - Racing Game Style</title>
  
  <!-- Load A-Frame and AR.js from a reliable source -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
  
  <script>
    window.onload = function() {
      console.log("Page loaded. Click anywhere to start AR.");
      document.getElementById('loading-message').style.display = 'block';
      
      document.addEventListener('click', function() {
        console.log("Click detected - Starting AR session");
        
        const loadingMessage = document.getElementById('loading-message');
        if (loadingMessage) loadingMessage.style.display = 'none';
        
        const clickMessage = document.getElementById('click-message');
        if (clickMessage) clickMessage.style.display = 'none';
        
        // Ensure AR.js initializes correctly
        document.querySelector('a-scene').setAttribute('arjs', 'sourceType: webcam;');
      }, { once: true }); // Ensures it only triggers once
    };
    
    AFRAME.registerComponent('drift-entry', {
      init: function () {
        this.el.setAttribute('position', '-2 0 -1'); // Start offscreen
        this.el.setAttribute('rotation', '0 45 0');
        this.el.addEventListener('model-loaded', () => {
          this.startDrift();
        });
      },
      startDrift: function () {
        this.el.setAttribute('animation', {
          property: 'position',
          to: '0 0 0',
          dur: 2000,
          easing: 'easeOutQuad'
        });
        this.el.setAttribute('animation__rotation', {
          property: 'rotation',
          to: '0 0 0',
          dur: 2000,
          easing: 'easeOutQuad'
        });
      }
    });
    
    AFRAME.registerComponent('showroom-animation', {
      tick: function (time, timeDelta) {
        let angle = (time / 1000) * 10;
        this.el.setAttribute('rotation', `0 ${angle} 0`);
      }
    });
  </script>
  
  <style>
    #loading-message, #click-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px;
      border-radius: 10px;
      font-family: Arial, sans-serif;
      text-align: center;
      z-index: 9999;
    }
    #loading-message { display: none; }
  </style>
</head>
<body style="margin: 0; overflow: hidden;">
  <!-- Click message -->
  <div id="click-message">Click anywhere to start the AR experience<br><small>Camera and motion sensor access required</small></div>
  
  <!-- Loading message -->
  <div id="loading-message">
    <h2>Starting AR Experience</h2>
    <p>Please allow camera access when prompted</p>
  </div>
  
  <!-- A-Frame scene -->
  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
    <a-marker preset="hiro">
      <a-entity gltf-model="./scene.glb" scale="0.5 0.5 0.5" drift-entry showroom-animation></a-entity>
    </a-marker>
    <a-entity camera></a-entity>
  </a-scene>
  
  <!-- Debug and Controls -->
  <div id="debug-info">
    <p>AR Racing Drift</p>
    <p id="debug-message">Waiting for marker...</p>
    <div class="debug-heading">Marker:</div>
    <p>Status: <span id="marker-status">Hidden</span></p>
  </div>
</body>
</html>

