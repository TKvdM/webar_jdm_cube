<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAR JDM Cube</title>

    <!-- A-Frame library -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <!-- AR.js 1.7.2 version (more stable with A-Frame) -->
    <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/AR.js@1.7.2/aframe/build/aframe-ar.js"></script>

    <script>
        // Road animation component (moves the road texture)
        AFRAME.registerComponent('road-animation', {
            tick: function (time, timeDelta) {
                let mesh = this.el.getObject3D('mesh');
                if (mesh && mesh.material && mesh.material.map) {
                    mesh.material.map.offset.y -= timeDelta * 0.0005; // Moves texture downwards
                }
            }
        });

        // Drift animation for the car
        function driftCar() {
            let car = document.querySelector("#car");
            car.setAttribute("animation", "property: position; to: 0 0.1 -0.5; dur: 1000; easing: easeOutQuad");
            setTimeout(() => {
                car.setAttribute("animation", "property: rotation; to: 0 180 0; dur: 500");
            }, 1000);
        }
    </script>
</head>
<body style="margin: 0; overflow: hidden;">
    <!-- A-Frame AR.js scene setup -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;">

        <!-- Hiro marker preset -->
        <a-marker preset="hiro">
            <!-- Road at the bottom -->
            <a-plane id="road" width="1" height="2" position="0 -0.1 0" rotation="-90 0 0" 
                     material="color: gray; src: assets/Material.011_baseColor.png; repeat: 1 3; side: double" road-animation></a-plane>

            <!-- Car model -->
            <a-entity id="car" gltf-model="assets/scene.glb" position="0 -0.05 0" scale="0.1 0.1 0.1"></a-entity>
        </a-marker>

        <!-- Camera -->
        <a-entity camera></a-entity>

    </a-scene>

    <!-- Drift Button -->
    <button onclick="driftCar()" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 10px 20px; font-size: 20px;">Drift</button>

</body>
</html>
